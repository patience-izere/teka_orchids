{% extends 'chef_portal/base.html' %}
{% load static %}

{% block title %}Analytics Dashboard - Chef Portal{% endblock %}

{% block extra_css %}
<style>
    .analytics-header {
        background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .analytics-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
    }
    
    .period-selector {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .period-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .period-btn {
        padding: 8px 20px;
        border: 2px solid #e9ecef;
        border-radius: 20px;
        background: white;
        color: #666;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        text-decoration: none;
    }
    
    .period-btn:hover,
    .period-btn.active {
        border-color: #fd7e14;
        background: #fd7e14;
        color: white;
        text-decoration: none;
    }
    
    .custom-date {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .date-input {
        padding: 8px 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 0.9rem;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .metric-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        position: relative;
        overflow: hidden;
    }
    
    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: var(--accent-color);
    }
    
    .metric-header {
        display: flex;
        justify-content: between;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    
    .metric-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-bottom: 15px;
    }
    
    .metric-title {
        font-size: 0.9rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
    }
    
    .metric-value {
        font-size: 2.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }
    
    .metric-change {
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .change-positive {
        color: #28a745;
    }
    
    .change-negative {
        color: #dc3545;
    }
    
    .change-neutral {
        color: #6c757d;
    }
    
    .revenue-card {
        --accent-color: #28a745;
    }
    
    .orders-card {
        --accent-color: #007bff;
    }
    
    .customers-card {
        --accent-color: #6f42c1;
    }
    
    .rating-card {
        --accent-color: #ffc107;
    }
    
    .charts-section {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }
    
    .chart-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
    }
    
    .chart-controls {
        display: flex;
        gap: 10px;
    }
    
    .chart-btn {
        padding: 6px 12px;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        background: white;
        color: #666;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
    }
    
    .chart-btn:hover,
    .chart-btn.active {
        background: #fd7e14;
        color: white;
        border-color: #fd7e14;
    }
    
    .chart-container {
        height: 300px;
        position: relative;
    }
    
    .performance-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
    }
    
    .top-items-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    
    .item-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .item-row {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .item-row:hover {
        background: #e9ecef;
    }
    
    .item-rank {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #fd7e14;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .item-info {
        flex: 1;
    }
    
    .item-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }
    
    .item-stats {
        font-size: 0.85rem;
        color: #666;
    }
    
    .item-value {
        font-weight: bold;
        color: #28a745;
        font-size: 1.1rem;
    }
    
    .insights-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .insight-card {
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #28a745;
        background: #f8f9fa;
    }
    
    .insight-icon {
        font-size: 1.5rem;
        margin-bottom: 10px;
    }
    
    .insight-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
    
    .insight-text {
        color: #666;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .export-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
    }
    
    .export-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 15px;
    }
    
    .btn-export {
        padding: 12px 25px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        background: white;
        color: #333;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-export:hover {
        border-color: #fd7e14;
        background: #fd7e14;
        color: white;
        text-decoration: none;
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 40px;
        color: #666;
    }
    
    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #fd7e14;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 1024px) {
        .charts-section {
            grid-template-columns: 1fr;
        }
        
        .performance-section {
            grid-template-columns: 1fr;
        }
        
        .period-selector {
            flex-direction: column;
            align-items: stretch;
        }
        
        .custom-date {
            justify-content: center;
        }
    }
    
    @media (max-width: 768px) {
        .metrics-grid {
            grid-template-columns: 1fr;
        }
        
        .period-buttons {
            justify-content: center;
        }
        
        .export-buttons {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="analytics-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1><i class="bi bi-bar-chart me-3"></i>Analytics Dashboard</h1>
                <p class="lead mb-0">Track your business performance and insights</p>
            </div>
            <div class="col-md-4 text-md-end">
                <button class="btn btn-outline-light" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh Data
                </button>
            </div>
        </div>
    </div>
    
    <!-- Period Selector -->
    <div class="period-selector">
        <div class="period-buttons">
            <button class="period-btn active" data-period="today">Today</button>
            <button class="period-btn" data-period="week">This Week</button>
            <button class="period-btn" data-period="month">This Month</button>
            <button class="period-btn" data-period="quarter">Quarter</button>
            <button class="period-btn" data-period="year">Year</button>
        </div>
        <div class="custom-date">
            <span>Custom Range:</span>
            <input type="date" class="date-input" id="date-from" value="{{ today|date:'Y-m-d' }}">
            <span>to</span>
            <input type="date" class="date-input" id="date-to" value="{{ today|date:'Y-m-d' }}">
            <button class="btn btn-primary btn-sm" onclick="applyCustomRange()">Apply</button>
        </div>
    </div>
    
    <!-- Key Metrics -->
    <div class="metrics-grid">
        <div class="metric-card revenue-card">
            <div class="metric-icon" style="background: var(--accent-color);">
                <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="metric-title">Total Revenue</div>
            <div class="metric-value" id="revenue-value">${{ analytics.total_revenue|floatformat:2|default:"0.00" }}</div>
            <div class="metric-change change-positive">
                <i class="bi bi-arrow-up"></i>
                <span id="revenue-change">+{{ analytics.revenue_change|floatformat:1|default:"0.0" }}%</span>
            </div>
        </div>
        
        <div class="metric-card orders-card">
            <div class="metric-icon" style="background: var(--accent-color);">
                <i class="bi bi-receipt"></i>
            </div>
            <div class="metric-title">Total Orders</div>
            <div class="metric-value" id="orders-value">{{ analytics.total_orders|default:"0" }}</div>
            <div class="metric-change change-positive">
                <i class="bi bi-arrow-up"></i>
                <span id="orders-change">+{{ analytics.orders_change|floatformat:1|default:"0.0" }}%</span>
            </div>
        </div>
        
        <div class="metric-card customers-card">
            <div class="metric-icon" style="background: var(--accent-color);">
                <i class="bi bi-people"></i>
            </div>
            <div class="metric-title">New Customers</div>
            <div class="metric-value" id="customers-value">{{ analytics.new_customers|default:"0" }}</div>
            <div class="metric-change change-positive">
                <i class="bi bi-arrow-up"></i>
                <span id="customers-change">+{{ analytics.customers_change|floatformat:1|default:"0.0" }}%</span>
            </div>
        </div>
        
        <div class="metric-card rating-card">
            <div class="metric-icon" style="background: var(--accent-color);">
                <i class="bi bi-star"></i>
            </div>
            <div class="metric-title">Average Rating</div>
            <div class="metric-value" id="rating-value">{{ analytics.average_rating|floatformat:1|default:"0.0" }}</div>
            <div class="metric-change change-neutral">
                <i class="bi bi-dash"></i>
                <span id="rating-change">{{ analytics.rating_change|floatformat:1|default:"0.0" }}</span>
            </div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Revenue Trend</h3>
                <div class="chart-controls">
                    <button class="chart-btn active" data-chart="revenue">Revenue</button>
                    <button class="chart-btn" data-chart="orders">Orders</button>
                    <button class="chart-btn" data-chart="customers">Customers</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
        
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Order Distribution</h3>
            </div>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Performance Section -->
    <div class="performance-section">
        <div class="top-items-card">
            <div class="chart-header">
                <h3 class="chart-title">Top Selling Items</h3>
                <button class="chart-btn" onclick="viewAllItems()">View All</button>
            </div>
            <div class="item-list">
                {% for item in top_items|slice:":5" %}
                <div class="item-row">
                    <div class="item-rank">{{ forloop.counter }}</div>
                    <div class="item-info">
                        <div class="item-name">{{ item.name }}</div>
                        <div class="item-stats">{{ item.total_orders }} orders ‚Ä¢ {{ item.total_quantity }} sold</div>
                    </div>
                    <div class="item-value">${{ item.total_revenue|floatformat:2 }}</div>
                </div>
                {% empty %}
                <div class="text-center text-muted py-4">
                    <i class="bi bi-box-seam fs-3 d-block mb-2"></i>
                    No sales data available yet
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="top-items-card">
            <div class="chart-header">
                <h3 class="chart-title">Peak Hours</h3>
            </div>
            <div class="item-list">
                {% for hour in peak_hours %}
                <div class="item-row">
                    <div class="item-rank">{{ hour.hour }}:00</div>
                    <div class="item-info">
                        <div class="item-name">{{ hour.period_name }}</div>
                        <div class="item-stats">{{ hour.order_count }} orders</div>
                    </div>
                    <div class="item-value">{{ hour.percentage|floatformat:0 }}%</div>
                </div>
                {% empty %}
                <div class="text-center text-muted py-4">
                    <i class="bi bi-clock fs-3 d-block mb-2"></i>
                    No order timing data available
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Business Insights -->
    <div class="insights-section">
        <div class="chart-header">
            <h3 class="chart-title">Business Insights</h3>
            <small class="text-muted">AI-powered recommendations based on your data</small>
        </div>
        
        <div class="insights-grid">
            <div class="insight-card">
                <div class="insight-icon">üéØ</div>
                <div class="insight-title">Peak Performance</div>
                <div class="insight-text">
                    Your busiest day is {{ insights.peak_day|default:"weekends" }} with an average of 
                    {{ insights.peak_orders|default:"15" }} orders. Consider preparing extra inventory.
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon">üí°</div>
                <div class="insight-title">Menu Optimization</div>
                <div class="insight-text">
                    {{ insights.top_category|default:"Main courses" }} represent {{ insights.category_percentage|default:"60" }}% 
                    of your sales. Consider expanding this category or promoting underperforming items.
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon">üìà</div>
                <div class="insight-title">Growth Opportunity</div>
                <div class="insight-text">
                    Your customer retention rate is {{ insights.retention_rate|default:"75" }}%. 
                    Implement a loyalty program to increase repeat orders.
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-icon">‚è∞</div>
                <div class="insight-title">Timing Insight</div>
                <div class="insight-text">
                    Orders peak at {{ insights.peak_hour|default:"7 PM" }}. Consider offering pre-order 
                    discounts during slower hours to balance demand.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Section -->
    <div class="export-section">
        <h4>Export Analytics Report</h4>
        <p class="text-muted">Generate comprehensive reports for your records or accounting purposes</p>
        
        <div class="export-buttons">
            <a href="#" class="btn-export" onclick="exportReport('pdf')">
                <i class="bi bi-file-pdf"></i>Export PDF Report
            </a>
            <a href="#" class="btn-export" onclick="exportReport('excel')">
                <i class="bi bi-file-spreadsheet"></i>Export Excel Data
            </a>
            <a href="#" class="btn-export" onclick="exportReport('csv')">
                <i class="bi bi-filetype-csv"></i>Export CSV Data
            </a>
        </div>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading analytics data...</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Chart instances
let trendChart;
let distributionChart;

// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeTrendChart();
    initializeDistributionChart();
});

// Period selector functionality
document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const period = this.dataset.period;
        loadPeriodData(period);
    });
});

// Chart control buttons
document.querySelectorAll('.chart-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const chartType = this.dataset.chart;
        if (chartType) {
            document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            updateTrendChart(chartType);
        }
    });
});

function initializeTrendChart() {
    const ctx = document.getElementById('trendChart').getContext('2d');
    
    trendChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_labels|safe|default:"[]" }},
            datasets: [{
                label: 'Revenue ($)',
                data: {{ revenue_data|safe|default:"[]" }},
                borderColor: '#fd7e14',
                backgroundColor: 'rgba(253, 126, 20, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

function initializeDistributionChart() {
    const ctx = document.getElementById('distributionChart').getContext('2d');
    
    distributionChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: {{ distribution_labels|safe|default:'["Delivery", "Pickup", "Dine-in"]' }},
            datasets: [{
                data: {{ distribution_data|safe|default:'[65, 25, 10]' }},
                backgroundColor: [
                    '#fd7e14',
                    '#28a745',
                    '#007bff',
                    '#6f42c1',
                    '#dc3545'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}

function updateTrendChart(type) {
    if (!trendChart) return;
    
    let data, label, color;
    
    switch(type) {
        case 'revenue':
            data = {{ revenue_data|safe|default:"[]" }};
            label = 'Revenue ($)';
            color = '#fd7e14';
            break;
        case 'orders':
            data = {{ orders_data|safe|default:"[]" }};
            label = 'Orders';
            color = '#007bff';
            break;
        case 'customers':
            data = {{ customers_data|safe|default:"[]" }};
            label = 'New Customers';
            color = '#6f42c1';
            break;
        default:
            return;
    }
    
    trendChart.data.datasets[0] = {
        label: label,
        data: data,
        borderColor: color,
        backgroundColor: color + '20',
        borderWidth: 3,
        fill: true,
        tension: 0.4
    };
    
    trendChart.update();
}

async function loadPeriodData(period) {
    showLoading(true);
    
    try {
        const response = await fetch('{% url "chef_portal:ajax_analytics_data" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ period: period })
        });
        
        const data = await response.json();
        
        if (data.success) {
            updateMetrics(data.analytics);
            updateCharts(data.chart_data);
            updateInsights(data.insights);
        }
    } catch (error) {
        console.error('Error loading analytics data:', error);
        showNotification('Error loading analytics data', 'error');
    }
    
    showLoading(false);
}

function updateMetrics(analytics) {
    document.getElementById('revenue-value').textContent = '$' + parseFloat(analytics.total_revenue).toFixed(2);
    document.getElementById('orders-value').textContent = analytics.total_orders;
    document.getElementById('customers-value').textContent = analytics.new_customers;
    document.getElementById('rating-value').textContent = parseFloat(analytics.average_rating).toFixed(1);
    
    // Update change percentages
    document.getElementById('revenue-change').textContent = 
        (analytics.revenue_change >= 0 ? '+' : '') + parseFloat(analytics.revenue_change).toFixed(1) + '%';
    document.getElementById('orders-change').textContent = 
        (analytics.orders_change >= 0 ? '+' : '') + parseFloat(analytics.orders_change).toFixed(1) + '%';
    document.getElementById('customers-change').textContent = 
        (analytics.customers_change >= 0 ? '+' : '') + parseFloat(analytics.customers_change).toFixed(1) + '%';
    document.getElementById('rating-change').textContent = 
        parseFloat(analytics.rating_change).toFixed(1);
}

function updateCharts(chartData) {
    if (trendChart && chartData.labels) {
        trendChart.data.labels = chartData.labels;
        trendChart.data.datasets[0].data = chartData.revenue_data;
        trendChart.update();
    }
    
    if (distributionChart && chartData.distribution_data) {
        distributionChart.data.datasets[0].data = chartData.distribution_data;
        distributionChart.update();
    }
}

function updateInsights(insights) {
    // Update insight cards with new data
    // This would update the insight text with new recommendations
}

function applyCustomRange() {
    const dateFrom = document.getElementById('date-from').value;
    const dateTo = document.getElementById('date-to').value;
    
    if (!dateFrom || !dateTo) {
        showNotification('Please select both start and end dates', 'error');
        return;
    }
    
    if (new Date(dateFrom) > new Date(dateTo)) {
        showNotification('Start date must be before end date', 'error');
        return;
    }
    
    loadCustomRangeData(dateFrom, dateTo);
}

async function loadCustomRangeData(startDate, endDate) {
    showLoading(true);
    
    try {
        const response = await fetch('{% url "chef_portal:ajax_analytics_data" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ 
                period: 'custom',
                start_date: startDate,
                end_date: endDate
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            updateMetrics(data.analytics);
            updateCharts(data.chart_data);
            updateInsights(data.insights);
            
            // Update active period button
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        }
    } catch (error) {
        console.error('Error loading custom range data:', error);
        showNotification('Error loading data for selected range', 'error');
    }
    
    showLoading(false);
}

function refreshData() {
    const activePeriod = document.querySelector('.period-btn.active');
    if (activePeriod) {
        loadPeriodData(activePeriod.dataset.period);
    }
}

function viewAllItems() {
    window.location.href = '{% url "chef_portal:menu_management" %}';
}

function exportReport(format) {
    const period = document.querySelector('.period-btn.active').dataset.period;
    const url = `{% url 'chef_portal:export_analytics' %}?format=${format}&period=${period}`;
    
    // Create temporary link to download file
    const link = document.createElement('a');
    link.href = url;
    link.download = `analytics_report_${period}.${format}`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification(`${format.toUpperCase()} report download started`, 'success');
}

function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    if (show) {
        spinner.style.display = 'block';
    } else {
        spinner.style.display = 'none';
    }
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}

// Auto-refresh data every 5 minutes
setInterval(refreshData, 300000);
</script>
{% endblock %}